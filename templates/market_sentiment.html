<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Sentiment - News Intelligence AI</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="{{ url_for('static', filename='js/htmx.min.js') }}"></script>
    <style>
        .sentiment-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; }
        .sentiment-panel { background: var(--card-bg); border-radius: 12px; padding: 1.5rem; border: 1px solid var(--border-color); }
        .sentiment-panel h3 { font-size: 1rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 1rem; }

        .mood-display { text-align: center; padding: 1rem 0; }
        .mood-number { font-size: 4rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; line-height: 1; }
        .mood-number.fear { color: #ef4444; }
        .mood-number.greed { color: #10b981; }
        .mood-number.neutral { color: #6b7280; }
        .mood-label { font-size: 1.25rem; font-weight: 600; margin-top: 0.5rem; }
        .mood-scale { display: flex; justify-content: space-between; margin-top: 1rem; font-size: 0.75rem; color: var(--text-secondary); }
        .mood-bar { height: 12px; background: linear-gradient(90deg, #ef4444, #f59e0b, #6b7280, #34d399, #10b981); border-radius: 6px; margin: 0.5rem 0; position: relative; }
        .mood-indicator { position: absolute; top: -4px; width: 4px; height: 20px; background: white; border-radius: 2px; transform: translateX(-50%); box-shadow: 0 2px 4px rgba(0,0,0,0.3); }

        .regime-badge { display: inline-block; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; }
        .regime-badge.bull { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .regime-badge.bear { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .regime-badge.sideways { background: rgba(107, 114, 128, 0.2); color: #9ca3af; }
        .regime-badge.volatile { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }

        .stat-row { display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid var(--border-color); }
        .stat-row:last-child { border-bottom: none; }
        .stat-label { color: var(--text-secondary); }
        .stat-value { font-weight: 600; font-family: 'JetBrains Mono', monospace; }

        .distribution-bars { margin-top: 1rem; }
        .dist-row { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem; }
        .dist-label { width: 100px; font-size: 0.875rem; color: var(--text-secondary); }
        .dist-bar-container { flex: 1; height: 24px; background: var(--border-color); border-radius: 4px; overflow: hidden; }
        .dist-bar { height: 100%; border-radius: 4px; display: flex; align-items: center; justify-content: flex-end; padding-right: 0.5rem; font-size: 0.75rem; font-weight: 600; color: white; }
        .dist-bar.strong-bullish { background: #10b981; }
        .dist-bar.bullish { background: #34d399; }
        .dist-bar.neutral { background: #6b7280; }
        .dist-bar.bearish { background: #f87171; }
        .dist-bar.strong-bearish { background: #ef4444; }

        .sector-heatmap { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 0.5rem; }
        .sector-cell { padding: 0.75rem; border-radius: 8px; text-align: center; font-size: 0.75rem; font-weight: 500; }
        .sector-cell .score { font-size: 1rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
    </style>
</head>
<body>

    {% set active_tab = 'mood' %}
    {% include 'components/nav.html' %}

        <div class="dashboard-header">
            <div>
                <h2 class="dashboard-title">Market Sentiment</h2>
                <p class="dashboard-subtitle">Overall market mood and sector sentiment analysis</p>
            </div>
        </div>

        <div class="sentiment-grid">
            <!-- Market Mood Gauge -->
            <div class="sentiment-panel">
                <h3>Fear & Greed Index</h3>
                {% if market_context %}
                <div class="mood-display">
                    <div class="mood-number {% if market_context.mood_score <= 35 %}fear{% elif market_context.mood_score >= 65 %}greed{% else %}neutral{% endif %}">
                        {{ market_context.mood_score|round|int }}
                    </div>
                    <div class="mood-label">{{ mood_label }}</div>
                </div>
                <div class="mood-bar">
                    <div class="mood-indicator" style="left: {{ market_context.mood_score }}%;"></div>
                </div>
                <div class="mood-scale">
                    <span>Extreme Fear</span>
                    <span>Fear</span>
                    <span>Neutral</span>
                    <span>Greed</span>
                    <span>Extreme Greed</span>
                </div>
                {% else %}
                <div class="mood-display">
                    <div class="mood-number neutral">--</div>
                    <div class="mood-label">No Data</div>
                </div>
                {% endif %}
            </div>

            <!-- Market Regime -->
            <div class="sentiment-panel">
                <h3>Market Regime</h3>
                {% if market_context %}
                <div style="text-align: center; padding: 1rem 0;">
                    <div class="regime-badge {{ market_context.regime }}">
                        {{ regime_label }}
                    </div>
                </div>
                <div style="margin-top: 1rem;">
                    <div class="stat-row">
                        <span class="stat-label">Volatility Level</span>
                        <span class="stat-value">{{ market_context.volatility_level|round(1) if market_context.volatility_level else 'N/A' }}</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">S&P 500 Change</span>
                        <span class="stat-value" style="color: {% if market_context.sp500_pct_change and market_context.sp500_pct_change > 0 %}#10b981{% elif market_context.sp500_pct_change and market_context.sp500_pct_change < 0 %}#ef4444{% else %}inherit{% endif %};">
                            {{ market_context.sp500_pct_change|round(2) if market_context.sp500_pct_change else 'N/A' }}%
                        </span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">NASDAQ Change</span>
                        <span class="stat-value" style="color: {% if market_context.nasdaq_pct_change and market_context.nasdaq_pct_change > 0 %}#10b981{% elif market_context.nasdaq_pct_change and market_context.nasdaq_pct_change < 0 %}#ef4444{% else %}inherit{% endif %};">
                            {{ market_context.nasdaq_pct_change|round(2) if market_context.nasdaq_pct_change else 'N/A' }}%
                        </span>
                    </div>
                </div>
                {% else %}
                <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                    No market data available
                </div>
                {% endif %}
            </div>

            <!-- Sentiment Distribution -->
            <div class="sentiment-panel">
                <h3>Signal Distribution</h3>
                {% if sentiment_summary and sentiment_summary.distribution %}
                {% set dist = sentiment_summary.distribution %}
                {% set total = dist.strong_bullish + dist.bullish + dist.neutral + dist.bearish + dist.strong_bearish %}
                <div class="distribution-bars">
                    <div class="dist-row">
                        <span class="dist-label">Strong Bullish</span>
                        <div class="dist-bar-container">
                            <div class="dist-bar strong-bullish" style="width: {{ (dist.strong_bullish / total * 100)|round|int if total > 0 else 0 }}%;">
                                {{ dist.strong_bullish }}
                            </div>
                        </div>
                    </div>
                    <div class="dist-row">
                        <span class="dist-label">Bullish</span>
                        <div class="dist-bar-container">
                            <div class="dist-bar bullish" style="width: {{ (dist.bullish / total * 100)|round|int if total > 0 else 0 }}%;">
                                {{ dist.bullish }}
                            </div>
                        </div>
                    </div>
                    <div class="dist-row">
                        <span class="dist-label">Neutral</span>
                        <div class="dist-bar-container">
                            <div class="dist-bar neutral" style="width: {{ (dist.neutral / total * 100)|round|int if total > 0 else 0 }}%;">
                                {{ dist.neutral }}
                            </div>
                        </div>
                    </div>
                    <div class="dist-row">
                        <span class="dist-label">Bearish</span>
                        <div class="dist-bar-container">
                            <div class="dist-bar bearish" style="width: {{ (dist.bearish / total * 100)|round|int if total > 0 else 0 }}%;">
                                {{ dist.bearish }}
                            </div>
                        </div>
                    </div>
                    <div class="dist-row">
                        <span class="dist-label">Strong Bearish</span>
                        <div class="dist-bar-container">
                            <div class="dist-bar strong-bearish" style="width: {{ (dist.strong_bearish / total * 100)|round|int if total > 0 else 0 }}%;">
                                {{ dist.strong_bearish }}
                            </div>
                        </div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 1rem; color: var(--text-secondary); font-size: 0.875rem;">
                    Total tickers analyzed: {{ total }}
                </div>
                {% else %}
                <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                    No sentiment data available
                </div>
                {% endif %}
            </div>

            <!-- Sentiment Summary Stats -->
            <div class="sentiment-panel">
                <h3>Summary Statistics</h3>
                {% if sentiment_summary %}
                <div class="stat-row">
                    <span class="stat-label">Average Sentiment</span>
                    <span class="stat-value" style="color: {% if sentiment_summary.avg_sentiment > 0 %}#10b981{% elif sentiment_summary.avg_sentiment < 0 %}#ef4444{% else %}inherit{% endif %};">
                        {{ (sentiment_summary.avg_sentiment * 100)|round|int }}%
                    </span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Median Sentiment</span>
                    <span class="stat-value">{{ (sentiment_summary.median_sentiment * 100)|round|int }}%</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Bullish Ratio</span>
                    <span class="stat-value">{{ (sentiment_summary.bullish_ratio * 100)|round|int }}%</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Total Tickers</span>
                    <span class="stat-value">{{ sentiment_summary.total_tickers }}</span>
                </div>
                {% else %}
                <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                    No data available
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Sector Sentiment Heatmap -->
        {% if sector_sentiment %}
        <div class="sentiment-panel" style="margin-top: 1.5rem;">
            <h3>Sector Sentiment Heatmap</h3>
            <div class="sector-heatmap">
                {% for sector, score in sector_sentiment.items() %}
                {% set intensity = ((score + 1) / 2 * 100)|int %}
                {% if score > 0.3 %}
                    {% set bg_color = 'rgba(16, 185, 129, ' ~ (0.2 + score * 0.4) ~ ')' %}
                    {% set text_color = '#10b981' %}
                {% elif score < -0.3 %}
                    {% set bg_color = 'rgba(239, 68, 68, ' ~ (0.2 + (-score) * 0.4) ~ ')' %}
                    {% set text_color = '#ef4444' %}
                {% else %}
                    {% set bg_color = 'rgba(107, 114, 128, 0.2)' %}
                    {% set text_color = '#9ca3af' %}
                {% endif %}
                <div class="sector-cell" style="background: {{ bg_color }}; color: {{ text_color }};">
                    <div>{{ sector }}</div>
                    <div class="score">{{ (score * 100)|round|int }}%</div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

    </main>

</body>
</html>
