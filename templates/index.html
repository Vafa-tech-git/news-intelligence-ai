<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI news intelligence</title>

    <script src="https://cdn.tailwindcss.com"></script> 
    
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    <style>
        /* AnimaÈ›ie pentru indicatorul de Ã®ncÄƒrcare */
        .htmx-indicator{ display:none; }
        .htmx-request .htmx-indicator{ display:inline-block; }
        .htmx-request.htmx-indicator{ display:inline-block; }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans min-h-screen">

    <nav class="bg-gray-800 border-b border-gray-700 p-4 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                <h1 class="text-xl font-bold tracking-tight">
                    News<span class="text-blue-500">intelligence</span> AI
                </h1>
            </div>
            <div class="text-xs text-gray-500">
                Powered by Ollama (gpt-oss:120b)
            </div>
        </div>
    </nav>

    <div class="container mx-auto max-w-4xl p-6">

        <div id="main-tabs" class="flex space-x-6 mb-6 border-b border-gray-700 pb-2">
            <a href="/" class="text-lg font-bold pb-2 transition 
               {% if not showing_saved %} text-blue-400 border-b-2 border-blue-400 
               {% else %} text-gray-400 hover:text-white {% endif %}">
               ðŸ“° Toate È™tirile
            </a>

            <a href="/saved" class="text-lg font-bold pb-2 transition 
               {% if showing_saved %} text-yellow-400 border-b-2 border-yellow-400 
               {% else %} text-gray-400 hover:text-white {% endif %}">
               ðŸ”– Salvate
            </a>
        </div>

        <div class="flex justify-between items-center mb-8 bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700">
            <div>
            <h2 class="text-2xl font-bold text-white">Dashboard analizÄƒ</h2>
            <p class="text-gray-400 text-sm mt-1">MonitorizeazÄƒ pieÈ›ele Ã®n timp real folosind AI.</p>
        </div>

        <div class="flex space-x-4">
            
        {% if not showing_saved %}

            <button hx-post="/reset-db" 
                    hx-target="#news-feed" 
                    hx-swap="innerHTML"
                    hx-confirm="âš ï¸ EÈ™ti sigur cÄƒ vrei sÄƒ cureÈ›i feed-ul? (È˜tirile din tab-ul 'Salvate' VOR FI PÄ‚STRATE)?"
                    class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition flex items-center shadow-lg hover:shadow-red-500/30 ring-1 ring-red-500/50">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                Reset DB
            </button>

            <button hx-post="/scan-news" 
                    hx-target="#news-feed" 
                    hx-swap="innerHTML" 
                    hx-indicator="#spinner"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition flex items-center shadow-lg hover:shadow-blue-500/30">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>
                ScaneazÄƒ acum
            </button>

        {% else %}
            
            <div class="flex items-center text-gray-400 text-sm italic border border-gray-700 p-3 rounded bg-gray-800/50 w-full justify-center">
                <span>Nu poÈ›i scana aici. Mergi la </span>
                
                <a href="/" class="ml-1 text-blue-400 font-bold hover:text-blue-300 hover:underline flex items-center transition">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                    Toate È™tirile
                </a>
            </div>

        {% endif %}

        </div>
    </div>

        <div id="spinner" class="htmx-indicator flex justify-center items-center py-8 mb-4 bg-gray-800/50 rounded-lg border border-blue-500/30 border-dashed">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mr-3"></div>
            <span class="text-blue-400 font-mono text-sm">
                Se colecteazÄƒ date & ruleazÄƒ modelul 120b... (Poate dura 10-20 sec)
            </span>
        </div>

        <div id="news-feed" class="grid grid-cols-1 gap-6 pb-20">
        
        {% if news_list %}
            {% for news in news_list %}
                {% include 'news_card.html' %}
            {% endfor %}
        
        {% else %}
            <div class="col-span-1 flex flex-col items-center justify-center text-center py-20 border-2 border-dashed border-gray-800 rounded-xl">
                
                {% if showing_saved %}
                    <div class="text-gray-500">
                        <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                        </svg>
                        <h3 class="text-xl font-bold text-gray-300">Nu ai salvat nimic Ã®ncÄƒ</h3>
                        <p class="mt-2 text-sm max-w-xs mx-auto">
                            Mergi la tab-ul 
                            
                            <a href="/" class="text-blue-400 font-bold hover:text-blue-300 hover:underline transition">
                                Toate È™tirile
                            </a>
                            
                            È™i apasÄƒ pe iconiÈ›a 
                            <span class="inline-block align-middle"><svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path></svg></span>
                            pentru a pÄƒstra articolele importante aici.
                        </p>
                    </div>

                {% else %}
                    <div class="text-gray-500">
                        <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                        </svg>
                        <h3 class="text-xl font-bold text-gray-300">Baza de date este goalÄƒ</h3>
                        <p class="mt-2 text-sm">
                            ApasÄƒ butonul 
                            
                            <a href="#" 
                               hx-post="/scan-news" 
                               hx-target="#news-feed" 
                               hx-swap="innerHTML" 
                               hx-indicator="#spinner"
                               class="text-blue-500 font-bold hover:text-blue-400 hover:underline cursor-pointer transition">
                               ScaneazÄƒ acum
                            </a>
                            de mai sus pentru a popula feed-ul.
                        </p>
                    </div>
                
                    {% endif %}

            </div>
        {% endif %}
        </div>
    </div>

    <script>
        document.body.addEventListener('htmx:beforeRequest', function(evt) {
            // VerificÄƒm dacÄƒ cererea este cea de Scanare (care È›inteÈ™te #news-feed)
            if (evt.detail.target.id === 'news-feed') {
                const tabs = document.getElementById('main-tabs');
                // AdÄƒugÄƒm clase Tailwind: 
                // pointer-events-none = Nu poÈ›i da click
                // opacity-50 = AratÄƒ È™ters/inactiv
                tabs.classList.add('pointer-events-none', 'opacity-50');
            }
        });

        document.body.addEventListener('htmx:afterOnLoad', function(evt) {
            // CÃ¢nd s-a terminat, le reactivÄƒm
            if (evt.detail.target.id === 'news-feed') {
                const tabs = document.getElementById('main-tabs');
                tabs.classList.remove('pointer-events-none', 'opacity-50');
            }
        });
    </script>

</body>

</body>
</html>