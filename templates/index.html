<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Intelligence AI</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="{{ url_for('static', filename='js/htmx.min.js') }}"></script>
</head>
<body>

    {% set active_tab = 'saved' if showing_saved else 'news' %}
    {% set refresh_indicator = refresh_interval and refresh_interval != '0' %}
    {% include 'components/nav.html' %}

        <div class="dashboard-header">
            <div>
                <h2 class="dashboard-title">Dashboard</h2>
                <p class="dashboard-subtitle">Real-time market monitoring with AI analysis</p>
            </div>

            <div class="dashboard-actions">
            {% if not showing_saved %}
                <button hx-post="/reset-db"
                        hx-target="#news-feed"
                        hx-swap="innerHTML"
                        hx-confirm="Clear the feed? (Saved items will be preserved)"
                        class="btn btn-danger">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                    Reset
                </button>

                <button hx-post="/scan-news"
                        hx-target="#news-feed"
                        hx-swap="innerHTML"
                        hx-indicator="#loading"
                        class="btn btn-primary">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    Scan Now
                </button>
            {% else %}
                <p class="text-secondary" style="font-size: 0.875rem;">
                    Go to <a href="/">All News</a> to scan for updates
                </p>
            {% endif %}
            </div>
        </div>

        <!-- Filter Chips -->
        <div class="filter-chips">
            <div class="filter-group">
                <span class="filter-label">Direction:</span>
                <a href="?{% if current_sector %}sector={{ current_sector }}&{% endif %}{% if current_sentiment %}sentiment={{ current_sentiment }}{% endif %}"
                   class="filter-chip {% if not current_direction %}active{% endif %}">All</a>
                <a href="?direction=bullish{% if current_sector %}&sector={{ current_sector }}{% endif %}{% if current_sentiment %}&sentiment={{ current_sentiment }}{% endif %}"
                   class="filter-chip bullish {% if current_direction == 'bullish' %}active{% endif %}">Bullish</a>
                <a href="?direction=bearish{% if current_sector %}&sector={{ current_sector }}{% endif %}{% if current_sentiment %}&sentiment={{ current_sentiment }}{% endif %}"
                   class="filter-chip bearish {% if current_direction == 'bearish' %}active{% endif %}">Bearish</a>
                <a href="?direction=neutral{% if current_sector %}&sector={{ current_sector }}{% endif %}{% if current_sentiment %}&sentiment={{ current_sentiment }}{% endif %}"
                   class="filter-chip neutral {% if current_direction == 'neutral' %}active{% endif %}">Neutral</a>
            </div>

            <div class="filter-group">
                <span class="filter-label">Sentiment:</span>
                <a href="?{% if current_direction %}direction={{ current_direction }}&{% endif %}{% if current_sector %}sector={{ current_sector }}{% endif %}"
                   class="filter-chip {% if not current_sentiment %}active{% endif %}">All</a>
                <a href="?sentiment=positive{% if current_direction %}&direction={{ current_direction }}{% endif %}{% if current_sector %}&sector={{ current_sector }}{% endif %}"
                   class="filter-chip positive {% if current_sentiment == 'positive' %}active{% endif %}">Positive</a>
                <a href="?sentiment=negative{% if current_direction %}&direction={{ current_direction }}{% endif %}{% if current_sector %}&sector={{ current_sector }}{% endif %}"
                   class="filter-chip negative {% if current_sentiment == 'negative' %}active{% endif %}">Negative</a>
                <a href="?sentiment=neutral{% if current_direction %}&direction={{ current_direction }}{% endif %}{% if current_sector %}&sector={{ current_sector }}{% endif %}"
                   class="filter-chip neutral {% if current_sentiment == 'neutral' %}active{% endif %}">Neutral</a>
            </div>

            {% if sectors %}
            <div class="filter-group">
                <span class="filter-label">Sector:</span>
                <a href="?{% if current_direction %}direction={{ current_direction }}&{% endif %}{% if current_sentiment %}sentiment={{ current_sentiment }}{% endif %}"
                   class="filter-chip {% if not current_sector %}active{% endif %}">All</a>
                {% for sector in sectors %}
                <a href="?sector={{ sector }}{% if current_direction %}&direction={{ current_direction }}{% endif %}{% if current_sentiment %}&sentiment={{ current_sentiment }}{% endif %}"
                   class="filter-chip {% if current_sector == sector %}active{% endif %}">{{ sector }}</a>
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <div id="loading" class="loading">
            <div class="spinner">
                <div class="spinner-ring"></div>
                <div class="spinner-arc"></div>
            </div>
            <div>
                <div class="loading-text">Processing...</div>
                <div class="loading-subtext">AI analysis in progress</div>
            </div>
        </div>

        <!-- News Feed with auto-refresh -->
        <div id="news-feed" class="news-feed"
             {% if refresh_interval and refresh_interval != '0' and not showing_saved %}
             hx-get="/feed?{% if current_sector %}sector={{ current_sector }}&{% endif %}{% if current_direction %}direction={{ current_direction }}&{% endif %}{% if current_sentiment %}sentiment={{ current_sentiment }}{% endif %}"
             hx-trigger="every {{ refresh_interval }}s"
             hx-swap="innerHTML"
             {% endif %}>

        {% if news_list %}
            {% for news in news_list %}
                {% include 'news_card.html' %}
            {% endfor %}

        {% else %}
            <div class="empty-state">

                {% if showing_saved %}
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                    </svg>
                    <h3>No saved articles</h3>
                    <p>Save articles from <a href="/">All News</a> using the bookmark icon</p>

                {% else %}
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                    <h3>Feed is empty</h3>
                    <p>
                        Click
                        <a href="#"
                           hx-post="/scan-news"
                           hx-target="#news-feed"
                           hx-swap="innerHTML"
                           hx-indicator="#loading">
                           Scan Now
                        </a>
                        to load news
                    </p>
                {% endif %}

            </div>
        {% endif %}
        </div>

        <!-- Keyboard shortcuts help -->
        <div class="keyboard-help">
            <span>j/k</span> navigate
            <span>s</span> save
            <span>o</span> open
            <span>r</span> refresh
        </div>
    </main>

    <script src="{{ url_for('static', filename='js/keyboard.js') }}"></script>
</body>
</html>
