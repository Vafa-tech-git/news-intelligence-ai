<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Economic Health - News Intelligence AI</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="{{ url_for('static', filename='js/htmx.min.js') }}"></script>
    <style>
        .health-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
        .health-panel { background: var(--card-bg); border-radius: 12px; padding: 1.5rem; border: 1px solid var(--border-color); }
        .health-panel h3 { font-size: 1rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 1rem; }

        .health-gauge { text-align: center; padding: 1.5rem 0; }
        .health-score { font-size: 5rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; line-height: 1; }
        .health-score.healthy { color: #10b981; }
        .health-score.caution { color: #f59e0b; }
        .health-score.warning { color: #ef4444; }
        .health-label { font-size: 1.5rem; font-weight: 600; margin-top: 0.5rem; }

        .regime-badge { display: inline-block; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; font-size: 1.1rem; }
        .regime-badge.expansion { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .regime-badge.peak { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .regime-badge.contraction { background: rgba(249, 115, 22, 0.2); color: #f97316; }
        .regime-badge.trough { background: rgba(239, 68, 68, 0.2); color: #ef4444; }

        .category-bar { margin-bottom: 1rem; }
        .category-header { display: flex; justify-content: space-between; margin-bottom: 0.5rem; }
        .category-name { font-weight: 500; }
        .category-score { font-family: 'JetBrains Mono', monospace; font-weight: 600; }
        .category-progress { height: 8px; background: var(--border-color); border-radius: 4px; overflow: hidden; }
        .category-fill { height: 100%; border-radius: 4px; transition: width 0.5s ease; }

        .warning-banner { background: rgba(239, 68, 68, 0.15); border: 1px solid #ef4444; border-radius: 8px; padding: 1rem 1.5rem; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 1rem; }
        .warning-icon { font-size: 1.5rem; }
        .warning-text { flex: 1; }
        .warning-title { font-weight: 600; color: #ef4444; margin-bottom: 0.25rem; }
        .warning-detail { font-size: 0.875rem; color: var(--text-secondary); }

        .indicator-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        .indicator-table th { text-align: left; padding: 0.75rem; border-bottom: 2px solid var(--border-color); font-size: 0.75rem; text-transform: uppercase; color: var(--text-secondary); }
        .indicator-table td { padding: 0.75rem; border-bottom: 1px solid var(--border-color); }
        .indicator-table tr:hover { background: rgba(255, 255, 255, 0.02); }
        .indicator-name { font-weight: 500; }
        .indicator-category { font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; }
        .indicator-value { font-family: 'JetBrains Mono', monospace; }
        .indicator-score { font-family: 'JetBrains Mono', monospace; font-weight: 600; }
        .trend-up { color: #10b981; }
        .trend-down { color: #ef4444; }
        .trend-stable { color: #6b7280; }

        .stat-row { display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid var(--border-color); }
        .stat-row:last-child { border-bottom: none; }
        .stat-label { color: var(--text-secondary); }
        .stat-value { font-weight: 600; font-family: 'JetBrains Mono', monospace; }

        .refresh-btn { background: var(--accent-color); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; }
        .refresh-btn:hover { opacity: 0.9; }
        .refresh-status { font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem; }
        .refresh-status.error { color: #ef4444; }

        .no-data { text-align: center; padding: 3rem; color: var(--text-secondary); }
        .no-data p { margin-bottom: 1rem; }
    </style>
</head>
<body>

    {% set active_tab = 'economy' %}
    {% include 'components/nav.html' %}

        <div class="dashboard-header">
            <div>
                <h2 class="dashboard-title">Economic Health Dashboard</h2>
                <p class="dashboard-subtitle">Macroeconomic indicators from FRED - 20 key metrics across 6 categories</p>
            </div>
            <div>
                <button class="refresh-btn" hx-post="/refresh-economic-data?backfill=true" hx-target="#refresh-result" hx-swap="innerHTML">
                    Fetch FRED Data
                </button>
                <div id="refresh-result"></div>
            </div>
        </div>

        {% if health and health.recession_warning %}
        <div class="warning-banner">
            <div class="warning-icon">&#9888;</div>
            <div class="warning-text">
                <div class="warning-title">Recession Warning Active</div>
                <div class="warning-detail">
                    Yield curve has been inverted for {{ health.inversion_months|default(0) }} month(s).
                    Recession probability: {{ health.recession_probability|default(0)|round|int }}%
                </div>
            </div>
        </div>
        {% endif %}

        {% if health %}
        <div class="health-grid">
            <!-- Economic Health Index -->
            <div class="health-panel">
                <h3>Economic Health Index</h3>
                <div class="health-gauge">
                    {% set score = health.overall_score|default(50) %}
                    <div class="health-score {% if score >= 60 %}healthy{% elif score >= 40 %}caution{% else %}warning{% endif %}">
                        {{ score|round|int }}
                    </div>
                    <div class="health-label">out of 100</div>
                </div>
                <div style="text-align: center; margin-top: 1rem;">
                    <div class="regime-badge {{ health.regime }}">
                        {{ regime_label }}
                    </div>
                </div>
                <div style="margin-top: 1.5rem;">
                    <div class="stat-row">
                        <span class="stat-label">Data Completeness</span>
                        <span class="stat-value">{{ health.data_completeness|default(0)|round|int }}%</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Recession Probability</span>
                        <span class="stat-value" style="color: {% if health.recession_probability|default(0) >= 50 %}#ef4444{% elif health.recession_probability|default(0) >= 30 %}#f59e0b{% else %}#10b981{% endif %};">
                            {{ health.recession_probability|default(0)|round|int }}%
                        </span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Yield Curve</span>
                        <span class="stat-value" style="color: {% if health.yield_curve_inverted %}#ef4444{% else %}#10b981{% endif %};">
                            {% if health.yield_curve_inverted %}Inverted{% else %}Normal{% endif %}
                        </span>
                    </div>
                </div>
            </div>

            <!-- Category Scores -->
            <div class="health-panel">
                <h3>Category Breakdown</h3>
                {% if health.category_scores %}
                    {% for category, score in health.category_scores.items() %}
                    {% set safe_score = score|default(0) %}
                    <div class="category-bar">
                        <div class="category-header">
                            <span class="category-name">{{ category|title }}</span>
                            <span class="category-score" style="color: {% if safe_score >= 60 %}#10b981{% elif safe_score >= 40 %}#f59e0b{% else %}#ef4444{% endif %};">
                                {{ safe_score|round|int }}
                            </span>
                        </div>
                        <div class="category-progress">
                            <div class="category-fill" style="width: {{ safe_score }}%; background: {% if safe_score >= 60 %}#10b981{% elif safe_score >= 40 %}#f59e0b{% else %}#ef4444{% endif %};"></div>
                        </div>
                    </div>
                    {% endfor %}
                {% endif %}
                <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                    <h4 style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.75rem;">Category Weights</h4>
                    {% for category, weight in category_weights.items() %}
                    <div style="display: flex; justify-content: space-between; font-size: 0.875rem; padding: 0.25rem 0;">
                        <span style="color: var(--text-secondary);">{{ category|title }}</span>
                        <span style="font-family: 'JetBrains Mono', monospace;">{{ (weight * 100)|round|int }}%</span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Regime Info -->
            <div class="health-panel">
                <h3>Regime Classification</h3>
                <div style="margin-bottom: 1.5rem;">
                    <div class="stat-row">
                        <span class="stat-label">Expansion (70-100)</span>
                        <span style="color: #10b981;">Strong growth, low unemployment</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Peak (60-70)</span>
                        <span style="color: #f59e0b;">Slowing growth, tight labor</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Contraction (30-60)</span>
                        <span style="color: #f97316;">Negative growth, rising unemployment</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Trough (0-30)</span>
                        <span style="color: #ef4444;">Deep recession conditions</span>
                    </div>
                </div>
                <div style="padding-top: 1rem; border-top: 1px solid var(--border-color);">
                    <div class="stat-row">
                        <span class="stat-label">Overall Trend</span>
                        <span class="stat-value {% if health.overall_trend == 'improving' %}trend-up{% elif health.overall_trend == 'deteriorating' %}trend-down{% else %}trend-stable{% endif %}">
                            {{ health.overall_trend|title if health.overall_trend else 'Stable' }}
                        </span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Last Updated</span>
                        <span class="stat-value">{{ health.date }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Indicator Table -->
        {% if health.indicators %}
        <div class="health-panel" style="margin-top: 1.5rem;">
            <h3>All 20 Indicators</h3>
            <table class="indicator-table">
                <thead>
                    <tr>
                        <th>Indicator</th>
                        <th>Category</th>
                        <th>Value</th>
                        <th>Health Score</th>
                        <th>Trend</th>
                        <th>Percentile</th>
                    </tr>
                </thead>
                <tbody>
                    {% for series_id, ind in health.indicators.items() %}
                    <tr>
                        <td>
                            <div class="indicator-name">{{ ind.name }}</div>
                            <div style="font-size: 0.75rem; color: var(--text-secondary); font-family: 'JetBrains Mono', monospace;">{{ series_id }}</div>
                        </td>
                        <td class="indicator-category">{{ ind.category }}</td>
                        <td class="indicator-value">{{ ind.value|round(2) if ind.value is defined and ind.value is not none else 'N/A' }}</td>
                        <td>
                            <span class="indicator-score" style="color: {% if ind.health_score|default(0) >= 60 %}#10b981{% elif ind.health_score|default(0) >= 40 %}#f59e0b{% else %}#ef4444{% endif %};">
                                {{ ind.health_score|round|int if ind.health_score is defined and ind.health_score is not none else 'N/A' }}
                            </span>
                        </td>
                        <td>
                            {% if ind.trend == 'improving' %}
                            <span class="trend-up">&#9650; Improving</span>
                            {% elif ind.trend == 'deteriorating' %}
                            <span class="trend-down">&#9660; Deteriorating</span>
                            {% else %}
                            <span class="trend-stable">&#9644; Stable</span>
                            {% endif %}
                        </td>
                        <td class="indicator-value">{{ (ind.percentile|round|int ~ '%') if ind.percentile is defined and ind.percentile is not none else 'N/A' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        {% else %}
        <div class="health-panel">
            <div class="no-data">
                <p>No economic health data available yet.</p>
                <p>Click the button above to fetch indicators from FRED.</p>
                <p style="font-size: 0.875rem; margin-top: 1rem;">
                    Note: You need a FRED API key configured in your .env file.<br>
                    Get a free key at <a href="https://fred.stlouisfed.org/docs/api/api_key.html" target="_blank" style="color: var(--accent-color);">fred.stlouisfed.org</a>
                </p>
            </div>
        </div>
        {% endif %}

    </main>

</body>
</html>
